{"version":3,"sources":["App.js","serviceWorker.js","index.js"],"names":["generator","rough","createElement","id","x1","y1","x2","y2","type","roughElement","line","rectangle","points","x","y","Error","nearPoint","name","Math","abs","onLine","maxDistance","a","b","c","offset","distance","positionWithinElement","element","on","start","end","topLeft","topRight","bottomLeft","bottomRight","some","point","index","nextPoint","sqrt","pow","getElementAtPosition","elements","map","position","find","drawElement","roughCanvas","context","draw","stroke","length","d","reduce","acc","i","arr","x0","y0","push","join","getSvgPathFromStroke","getStroke","fill","Path2D","App","initialState","useState","setIndex","history","setHistory","action","overwrite","newState","historyCopy","updatedState","slice","prevState","useHistory","setElements","undo","redo","setAction","tool","setTool","selectedElement","setSelectedElement","useLayoutEffect","canvas","document","getElementById","getContext","clearRect","width","height","forEach","useEffect","undoRedoFunction","event","metaKey","ctrlKey","key","shiftKey","addEventListener","removeEventListener","updateElement","elementsCopy","style","checked","onChange","htmlFor","bottom","padding","onClick","window","location","reload","innerWidth","innerHeight","onMouseDown","clientX","clientY","xOffsets","yOffsets","offsetX","offsetY","onMouseMove","target","cursor","cursorForPosition","newPoints","_","newX1","newY1","coordinates","resizedCoordinates","onMouseUp","includes","adjustmentRequired","minX","min","maxX","max","adjustElementCoordinates","Boolean","hostname","match","ReactDOM","render","StrictMode","navigator","serviceWorker","ready","then","registration","unregister","catch","error","console","message"],"mappings":"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","file":"static/js/main.be975de9.chunk.js","sourcesContent":["import React, { useEffect, useLayoutEffect, useState } from \"react\";\r\nimport rough from \"roughjs/bundled/rough.esm\";\r\nimport getStroke from \"perfect-freehand\";\r\n\r\nconst generator = rough.generator();\r\n\r\nconst createElement = (id, x1, y1, x2, y2, type) => {\r\n  switch (type) {\r\n    case \"line\":\r\n    case \"rectangle\":\r\n      const roughElement =\r\n        type === \"line\"\r\n          ? generator.line(x1, y1, x2, y2)\r\n          : generator.rectangle(x1, y1, x2 - x1, y2 - y1);\r\n      return { id, x1, y1, x2, y2, type, roughElement };\r\n    case \"pencil\":\r\n      return { id, type, points: [{ x: x1, y: y1 }] };\r\n    default:\r\n      throw new Error(`Type not recognised: ${type}`);\r\n  }\r\n};\r\n\r\nconst nearPoint = (x, y, x1, y1, name) => {\r\n  return Math.abs(x - x1) < 5 && Math.abs(y - y1) < 5 ? name : null;\r\n};\r\n\r\nconst onLine = (x1, y1, x2, y2, x, y, maxDistance = 1) => {\r\n  const a = { x: x1, y: y1 };\r\n  const b = { x: x2, y: y2 };\r\n  const c = { x, y };\r\n  const offset = distance(a, b) - (distance(a, c) + distance(b, c));\r\n  return Math.abs(offset) < maxDistance ? \"inside\" : null;\r\n};\r\n\r\nconst positionWithinElement = (x, y, element) => {\r\n  const { type, x1, x2, y1, y2 } = element;\r\n  switch (type) {\r\n    case \"line\":\r\n      const on = onLine(x1, y1, x2, y2, x, y);\r\n      const start = nearPoint(x, y, x1, y1, \"start\");\r\n      const end = nearPoint(x, y, x2, y2, \"end\");\r\n      return start || end || on;\r\n    case \"rectangle\":\r\n      const topLeft = nearPoint(x, y, x1, y1, \"tl\");\r\n      const topRight = nearPoint(x, y, x2, y1, \"tr\");\r\n      const bottomLeft = nearPoint(x, y, x1, y2, \"bl\");\r\n      const bottomRight = nearPoint(x, y, x2, y2, \"br\");\r\n      const inside = x >= x1 && x <= x2 && y >= y1 && y <= y2 ? \"inside\" : null;\r\n      return topLeft || topRight || bottomLeft || bottomRight || inside;\r\n    case \"pencil\":\r\n      const betweenAnyPoint = element.points.some((point, index) => {\r\n        const nextPoint = element.points[index + 1];\r\n        if (!nextPoint) return false;\r\n        return onLine(point.x, point.y, nextPoint.x, nextPoint.y, x, y, 5) != null;\r\n      });\r\n      return betweenAnyPoint ? \"inside\" : null;\r\n    default:\r\n      throw new Error(`Type not recognised: ${type}`);\r\n  }\r\n};\r\n\r\nconst distance = (a, b) => Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2));\r\n\r\nconst getElementAtPosition = (x, y, elements) => {\r\n  return elements\r\n    .map(element => ({ ...element, position: positionWithinElement(x, y, element) }))\r\n    .find(element => element.position !== null);\r\n};\r\n\r\nconst adjustElementCoordinates = element => {\r\n  const { type, x1, y1, x2, y2 } = element;\r\n  if (type === \"rectangle\") {\r\n    const minX = Math.min(x1, x2);\r\n    const maxX = Math.max(x1, x2);\r\n    const minY = Math.min(y1, y2);\r\n    const maxY = Math.max(y1, y2);\r\n    return { x1: minX, y1: minY, x2: maxX, y2: maxY };\r\n  } else {\r\n    if (x1 < x2 || (x1 === x2 && y1 < y2)) {\r\n      return { x1, y1, x2, y2 };\r\n    } else {\r\n      return { x1: x2, y1: y2, x2: x1, y2: y1 };\r\n    }\r\n  }\r\n};\r\n\r\nconst cursorForPosition = position => {\r\n  switch (position) {\r\n    case \"tl\":\r\n    case \"br\":\r\n    case \"start\":\r\n    case \"end\":\r\n      return \"nwse-resize\";\r\n    case \"tr\":\r\n    case \"bl\":\r\n      return \"nesw-resize\";\r\n    default:\r\n      return \"move\";\r\n  }\r\n};\r\n\r\nconst resizedCoordinates = (clientX, clientY, position, coordinates) => {\r\n  const { x1, y1, x2, y2 } = coordinates;\r\n  switch (position) {\r\n    case \"tl\":\r\n    case \"start\":\r\n      return { x1: clientX, y1: clientY, x2, y2 };\r\n    case \"tr\":\r\n      return { x1, y1: clientY, x2: clientX, y2 };\r\n    case \"bl\":\r\n      return { x1: clientX, y1, x2, y2: clientY };\r\n    case \"br\":\r\n    case \"end\":\r\n      return { x1, y1, x2: clientX, y2: clientY };\r\n    default:\r\n      return null; //should not really get here...\r\n  }\r\n};\r\n\r\nconst useHistory = initialState => {\r\n  const [index, setIndex] = useState(0);\r\n  const [history, setHistory] = useState([initialState]);\r\n\r\n  const setState = (action, overwrite = false) => {\r\n    const newState = typeof action === \"function\" ? action(history[index]) : action;\r\n    if (overwrite) {\r\n      const historyCopy = [...history];\r\n      historyCopy[index] = newState;\r\n      setHistory(historyCopy);\r\n    } else {\r\n      const updatedState = [...history].slice(0, index + 1);\r\n      setHistory([...updatedState, newState]);\r\n      setIndex(prevState => prevState + 1);\r\n    }\r\n  };\r\n\r\n  const undo = () => index > 0 && setIndex(prevState => prevState - 1);\r\n  const redo = () => index < history.length - 1 && setIndex(prevState => prevState + 1);\r\n\r\n  return [history[index], setState, undo, redo];\r\n};\r\n\r\nconst getSvgPathFromStroke = stroke => {\r\n  if (!stroke.length) return \"\";\r\n\r\n  const d = stroke.reduce(\r\n    (acc, [x0, y0], i, arr) => {\r\n      const [x1, y1] = arr[(i + 1) % arr.length];\r\n      acc.push(x0, y0, (x0 + x1) / 2, (y0 + y1) / 2);\r\n      return acc;\r\n    },\r\n    [\"M\", ...stroke[0], \"Q\"]\r\n  );\r\n\r\n  d.push(\"Z\");\r\n  return d.join(\" \");\r\n};\r\n\r\nconst drawElement = (roughCanvas, context, element) => {\r\n  switch (element.type) {\r\n    case \"line\":\r\n    case \"rectangle\":\r\n      roughCanvas.draw(element.roughElement);\r\n      break;\r\n    case \"pencil\":\r\n      const stroke = getSvgPathFromStroke(getStroke(element.points));\r\n      context.fill(new Path2D(stroke));\r\n      break;\r\n    default:\r\n      throw new Error(`Type not recognised: ${element.type}`);\r\n  }\r\n};\r\n\r\nconst adjustmentRequired = type => [\"line\", \"rectangle\"].includes(type);\r\n\r\nconst App = () => {\r\n  const [elements, setElements, undo, redo] = useHistory([]);\r\n  const [action, setAction] = useState(\"none\");\r\n  const [tool, setTool] = useState(\"pencil\");\r\n  const [selectedElement, setSelectedElement] = useState(null);\r\n\r\n  useLayoutEffect(() => {\r\n    const canvas = document.getElementById(\"canvas\");\r\n    const context = canvas.getContext(\"2d\");\r\n    context.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    const roughCanvas = rough.canvas(canvas);\r\n\r\n    elements.forEach(element => drawElement(roughCanvas, context, element));\r\n  }, [elements]);\r\n\r\n  useEffect(() => {\r\n    const undoRedoFunction = event => {\r\n      if ((event.metaKey || event.ctrlKey) && event.key === \"z\") {\r\n        if (event.shiftKey) {\r\n          redo();\r\n        } else {\r\n          undo();\r\n        }\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"keydown\", undoRedoFunction);\r\n    return () => {\r\n      document.removeEventListener(\"keydown\", undoRedoFunction);\r\n    };\r\n  }, [undo, redo]);\r\n\r\n  const updateElement = (id, x1, y1, x2, y2, type) => {\r\n    const elementsCopy = [...elements];\r\n\r\n    switch (type) {\r\n      case \"line\":\r\n      case \"rectangle\":\r\n        elementsCopy[id] = createElement(id, x1, y1, x2, y2, type);\r\n        break;\r\n      case \"pencil\":\r\n        elementsCopy[id].points = [...elementsCopy[id].points, { x: x2, y: y2 }];\r\n        break;\r\n      default:\r\n        throw new Error(`Type not recognised: ${type}`);\r\n    }\r\n\r\n    setElements(elementsCopy, true);\r\n  };\r\n\r\n  const handleMouseDown = event => {\r\n    const { clientX, clientY } = event;\r\n    if (tool === \"selection\") {\r\n      const element = getElementAtPosition(clientX, clientY, elements);\r\n      if (element) {\r\n        if (element.type === \"pencil\") {\r\n          const xOffsets = element.points.map(point => clientX - point.x);\r\n          const yOffsets = element.points.map(point => clientY - point.y);\r\n          setSelectedElement({ ...element, xOffsets, yOffsets });\r\n        } else {\r\n          const offsetX = clientX - element.x1;\r\n          const offsetY = clientY - element.y1;\r\n          setSelectedElement({ ...element, offsetX, offsetY });\r\n        }\r\n        setElements(prevState => prevState);\r\n\r\n        if (element.position === \"inside\") {\r\n          setAction(\"moving\");\r\n        } else {\r\n          setAction(\"resizing\");\r\n        }\r\n      }\r\n    } else {\r\n      const id = elements.length;\r\n      const element = createElement(id, clientX, clientY, clientX, clientY, tool);\r\n      setElements(prevState => [...prevState, element]);\r\n      setSelectedElement(element);\r\n\r\n      setAction(\"drawing\");\r\n    }\r\n  };\r\n\r\n  const handleMouseMove = event => {\r\n    const { clientX, clientY } = event;\r\n\r\n    if (tool === \"selection\") {\r\n      const element = getElementAtPosition(clientX, clientY, elements);\r\n      event.target.style.cursor = element ? cursorForPosition(element.position) : \"default\";\r\n    }\r\n\r\n    if (action === \"drawing\") {\r\n      const index = elements.length - 1;\r\n      const { x1, y1 } = elements[index];\r\n      updateElement(index, x1, y1, clientX, clientY, tool);\r\n    } else if (action === \"moving\") {\r\n      if (selectedElement.type === \"pencil\") {\r\n        const newPoints = selectedElement.points.map((_, index) => ({\r\n          x: clientX - selectedElement.xOffsets[index],\r\n          y: clientY - selectedElement.yOffsets[index],\r\n        }));\r\n        const elementsCopy = [...elements];\r\n        elementsCopy[selectedElement.id] = {\r\n          ...elementsCopy[selectedElement.id],\r\n          points: newPoints,\r\n        };\r\n        setElements(elementsCopy, true);\r\n      } else {\r\n        const { id, x1, x2, y1, y2, type, offsetX, offsetY } = selectedElement;\r\n        const width = x2 - x1;\r\n        const height = y2 - y1;\r\n        const newX1 = clientX - offsetX;\r\n        const newY1 = clientY - offsetY;\r\n        updateElement(id, newX1, newY1, newX1 + width, newY1 + height, type);\r\n      }\r\n    } else if (action === \"resizing\") {\r\n      const { id, type, position, ...coordinates } = selectedElement;\r\n      const { x1, y1, x2, y2 } = resizedCoordinates(clientX, clientY, position, coordinates);\r\n      updateElement(id, x1, y1, x2, y2, type);\r\n    }\r\n  };\r\n\r\n  const handleMouseUp = () => {\r\n    if (selectedElement) {\r\n      const index = selectedElement.id;\r\n      const { id, type } = elements[index];\r\n      if ((action === \"drawing\" || action === \"resizing\") && adjustmentRequired(type)) {\r\n        const { x1, y1, x2, y2 } = adjustElementCoordinates(elements[index]);\r\n        updateElement(id, x1, y1, x2, y2, type);\r\n      }\r\n    }\r\n    setAction(\"none\");\r\n    setSelectedElement(null);\r\n  };\r\n\r\n  function refreshPage() {\r\n    window.location.reload(false);\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <div style={{ position: \"fixed\" }}>\r\n        <input\r\n          type=\"radio\"\r\n          id=\"selection\"\r\n          checked={tool === \"selection\"}\r\n          onChange={() => setTool(\"selection\")}\r\n        />\r\n        <label htmlFor=\"selection\">Selection</label>\r\n        <input type=\"radio\" id=\"line\" checked={tool === \"line\"} onChange={() => setTool(\"line\")} />\r\n        <label htmlFor=\"line\">Line</label>\r\n        <input\r\n          type=\"radio\"\r\n          id=\"rectangle\"\r\n          checked={tool === \"rectangle\"}\r\n          onChange={() => setTool(\"rectangle\")}\r\n        />\r\n        <label htmlFor=\"rectangle\">Rectangle</label>\r\n        <input\r\n          type=\"radio\"\r\n          id=\"pencil\"\r\n          checked={tool === \"pencil\"}\r\n          onChange={() => setTool(\"pencil\")}\r\n        />\r\n        <label htmlFor=\"pencil\">Pencil</label>\r\n      </div>\r\n      <div style={{ position: \"fixed\", bottom: 0, padding: 10 }}>\r\n        <button onClick={undo}>Undo</button>\r\n        <button onClick={redo}>Redo</button>\r\n        <button onClick={refreshPage}>Clear</button>\r\n      </div>\r\n      <canvas\r\n        id=\"canvas\"\r\n        width={window.innerWidth}\r\n        height={window.innerHeight}\r\n        onMouseDown={handleMouseDown}\r\n        onMouseMove={handleMouseMove}\r\n        onMouseUp={handleMouseUp}\r\n      >\r\n        Canvas\r\n      </canvas>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then(registration => {\r\n        registration.unregister();\r\n      })\r\n      .catch(error => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"./index.css\";\r\nimport App from \"./App\";\r\nimport * as serviceWorker from \"./serviceWorker\";\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById(\"root\")\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}